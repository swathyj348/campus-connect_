<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./load-svg.js"></script>
    <style>
        .map-container {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        .map-svg {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        .map-svg:active {
            cursor: grabbing;
        }
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
        }
        .search-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 90%;
            max-width: 500px;
        }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            z-index: 20;
            display: none;
        }
        .node {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .node:hover {
            opacity: 0.7;
        }        .node.selected {
            stroke: #000;
            stroke-width: 2;
        }
        
        /* Path styling */
        .path {
            fill: none;
            stroke: #FF4444;
            stroke-width: 4;
            stroke-dasharray: 10,5;
            stroke-linecap: round;
            opacity: 0.8;
            animation: pathAnimation 2s infinite linear;
        }
        
        @keyframes pathAnimation {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: 30; }
        }
        
        .path-waypoint {
            fill: #FF4444;
            stroke: #fff;
            stroke-width: 2;
            r: 8;
            opacity: 0.9;
        }
        
        /* Control panel styling */
        .path-controls {
            position: absolute;
            top: 80px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 15;
            max-width: 250px;
        }
        
        .control-button {
            background: #3B82F6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            font-size: 14px;
        }
        
        .control-button:hover {
            background: #2563EB;
        }
        
        .control-button.danger {
            background: #EF4444;
        }
        
        .control-button.danger:hover {
            background: #DC2626;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex items-center justify-between">
                <h1 class="text-xl font-bold text-gray-800">Campus Connect</h1>
                <nav class="hidden md:flex space-x-6">
                    <a href="#" class="nav-link text-gray-600 hover:text-blue-500">Home</a>
                    
                    <div class="relative">
                        <button id="floors-btn" class="nav-link text-gray-600 hover:text-blue-500">Floors</button>
                        <div id="floor-options" class="absolute left-0 mt-2 py-2 w-48 bg-white rounded-md shadow-xl z-20 hidden">
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 1</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 2</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 3</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 4</a>
                        </div>
                    </div>
                    
                    <a href="#" class="nav-link text-gray-600 hover:text-blue-500">About</a>
                </nav>
                <button class="md:hidden text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow relative">
            <!-- Search Bar -->
            <div class="search-overlay">
                <div class="relative">
                    <input
                        type="text"
                        placeholder="Search for a location..."
                        class="w-full py-3 px-4 pr-12 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <div class="absolute right-3 top-3 text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>                        </svg>
                    </div>
                </div>
            </div>

            <!-- Path Controls Panel -->
            <div class="path-controls" id="pathControls" style="display: none;">
                <h3 class="text-lg font-semibold mb-3">Navigation</h3>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">From:</label>
                    <select id="fromLocation" class="w-full p-2 border rounded text-sm">
                        <option value="">Select starting point</option>
                        <option value="library">Library</option>
                        <option value="cafeteria">Cafeteria</option>
                        <option value="hall">Main Hall</option>
                        <option value="lab">Computer Lab</option>
                        <option value="office">Admin Office</option>
                        <option value="entrance">Main Entrance</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">To:</label>
                    <select id="toLocation" class="w-full p-2 border rounded text-sm">
                        <option value="">Select destination</option>
                        <option value="library">Library</option>
                        <option value="cafeteria">Cafeteria</option>
                        <option value="hall">Main Hall</option>
                        <option value="lab">Computer Lab</option>
                        <option value="office">Admin Office</option>
                        <option value="entrance">Main Entrance</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button id="findPath" class="control-button">Find Route</button>
                    <button id="clearPath" class="control-button danger">Clear</button>
                </div>
            </div><!-- Map Container -->
            <div class="map-container">
                <!-- SVG Map -->
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    width="100%" viewBox="0 0 4259 2952" enable-background="new 0 0 4259 2952" xml:space="preserve" class="map-svg">
                    
                    <!-- Include the actual floor plan from 4th floor adl.svg -->
                    <g id="floor-plan">
                        <!-- Background -->
                        <path fill="#FFFFFF" opacity="1.000000" stroke="none" 
                            d="M2.000000,998.000000 C2.000000,665.333374 2.000000,333.666748 2.000000,2.000089 
                             C1421.999878,2.000059 2841.999756,2.000059 4262.000000,2.000030 
                             C4262.000000,985.999695 4262.000000,1969.999390 4262.000000,2953.999268 
                             C2842.000488,2953.999512 1422.000977,2953.999512 2.000744,2953.999756 
                             C2.000000,2302.333252 2.000000,1650.666626 2.000000,998.000000 
                             M145.992554,99.772049 
                             C145.995392,1019.200989 145.998230,1938.629883 146.001480,2858.058838 
                             C146.001480,2861.058105 145.839081,2864.072021 146.101807,2867.048340 
                             C146.194839,2868.102539 147.330963,2869.064941 149.278244,2871.093750 
                             C153.588013,2871.288574 157.897766,2871.654297 162.207535,2871.654297 
                             C1486.168457,2871.678955 2810.129395,2871.678467 4134.090332,2871.678223 
                             C4137.090332,2871.678223 4140.098145,2871.808350 4143.087402,2871.628174 
                             C4145.301270,2871.494873 4147.491699,2870.955078 4150.735840,2870.426514 
                             C4151.085449,2864.172852 4151.702637,2858.274902 4151.703125,2852.377197 
                             C4151.745605,1939.404053 4151.744141,1026.431030 4151.744141,113.457909 
                             C4151.744141,111.124641 4151.923340,108.773911 4151.698242,106.462502 
                             C4151.410645,103.503494 4150.796875,100.576210 4150.001465,96.702477 
                             C4149.614258,96.106575 4149.067871,95.764603 4146.739258,95.198509 
                             C4141.775879,94.884087 4136.812500,94.294258 4131.849121,94.294106 
                             C2809.387207,94.254196 1486.925415,94.255234 164.463577,94.255295 
                             C161.797318,94.255295 159.114700,94.071472 156.469177,94.305954 
                             C153.511017,94.568138 150.586533,95.210030 146.691330,96.074341 
                             C146.442398,96.695503 146.193466,97.316673 145.992554,99.772049 z"/>
                    </g>

                    <!-- Path Layer (for showing routes between nodes) -->
                    <g id="path-layer">
                        <!-- Paths will be dynamically added here -->
                    </g>

                    <!-- Interactive Nodes -->
                    <g id="nodes-layer">
                        <!-- Library Node -->
                        <circle id="node-library" cx="800" cy="500" r="15" fill="#FF6B6B" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Library">
                            <title>Library</title>
                        </circle>
                        
                        <!-- Cafeteria Node -->
                        <circle id="node-cafeteria" cx="1500" cy="800" r="15" fill="#4ECDC4" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Cafeteria">
                            <title>Cafeteria</title>
                        </circle>
                        
                        <!-- Main Hall Node -->
                        <circle id="node-hall" cx="2200" cy="600" r="15" fill="#45B7D1" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Main Hall">
                            <title>Main Hall</title>
                        </circle>
                        
                        <!-- Computer Lab Node -->
                        <circle id="node-lab" cx="2800" cy="1200" r="15" fill="#F9CA24" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Computer Lab">
                            <title>Computer Lab</title>
                        </circle>
                        
                        <!-- Office Node -->
                        <circle id="node-office" cx="3200" cy="400" r="15" fill="#6C5CE7" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Admin Office">
                            <title>Admin Office</title>
                        </circle>
                        
                        <!-- Entrance Node -->
                        <circle id="node-entrance" cx="1200" cy="1400" r="15" fill="#A0E7E5" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Main Entrance">
                            <title>Main Entrance</title>
                        </circle>
                    </g>
                </svg>

                <!-- Tooltip -->
                <div id="tooltip"></div>
            </div>

        <!-- Zoom Controls -->
        <div class="zoom-controls flex flex-col gap-2">
          <button class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
              <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
            </svg>
          </button>
          <button class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
              <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"></path>
            </svg>
          </button>
          <button class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256" transform="scale(-1, 1)">
              <path d="M229.66,98.21,53.41,33l-.16-.05A16,16,0,0,0,32.9,53.25a1,1,0,0,0,.05.16L98.21,229.33A15.77,15.77,0,0,0,113.28,240h.3a15.77,15.77,0,0,0,15-11.29l23.56-76.56,76.56-23.56a16,16,0,0,0,.62-30.38ZM224,113.3l-76.56,23.56a16,16,0,0,0-10.58,10.58L113.3,224h0l-.06-.17L48,48l175.82,65.22.16.06Z"></path>
            </svg>
          </button>
        </div>
      </main>

      <!-- Footer -->
      <footer class="bg-white py-4 shadow-inner">
        <div class="container mx-auto px-4 text-center text-gray-600">
          <p>© 2023 Campus Map. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const svg = document.querySelector('.map-svg');
        const zoomInBtn = document.querySelector('.zoom-controls button:nth-child(1)');
        const zoomOutBtn = document.querySelector('.zoom-controls button:nth-child(2)');
        const tooltip = document.getElementById('tooltip');
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX, startY;        // Zoom functionality
        zoomInBtn.addEventListener('click', function() {
          scale += 0.1;
          svg.style.transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
        });

        zoomOutBtn.addEventListener('click', function() {
          if (scale > 0.5) {
            scale -= 0.1;
            svg.style.transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
          }
        });

        // Pan functionality
        svg.addEventListener('mousedown', function(e) {
          isDragging = true;
          startX = e.clientX - translateX;
          startY = e.clientY - translateY;
        });

        svg.addEventListener('mousemove', function(e) {
          if (isDragging) {
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            svg.style.transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
          }
        });

        svg.addEventListener('mouseup', function() {
          isDragging = false;
        });        // Node interactivity
        document.querySelectorAll('.node').forEach(node => {
          node.addEventListener('mouseover', function(e) {
            const title = this.querySelector('title').textContent;
            tooltip.style.display = 'block';
            tooltip.style.left = e.pageX + 'px';
            tooltip.style.top = e.pageY + 'px';
            tooltip.textContent = title;
          });

          node.addEventListener('mouseout', function() {
            tooltip.style.display = 'none';
          });

          node.addEventListener('click', function() {
            this.classList.toggle('selected');
            showPathControls();
          });
        });

        // Show path controls when nodes are clicked
        function showPathControls() {
          const pathControls = document.getElementById('pathControls');
          pathControls.style.display = 'block';
        }

        // Path finding functionality
        const nodePositions = {
          library: { x: 800, y: 500 },
          cafeteria: { x: 1500, y: 800 },
          hall: { x: 2200, y: 600 },
          lab: { x: 2800, y: 1200 },
          office: { x: 3200, y: 400 },
          entrance: { x: 1200, y: 1400 }
        };

        function findPath(from, to) {
          if (!from || !to || from === to) return null;
          
          const fromPos = nodePositions[from];
          const toPos = nodePositions[to];
          
          if (!fromPos || !toPos) return null;

          // Simple pathfinding - in a real application you'd use A* or similar
          // For now, we'll create a simple path with waypoints
          const waypoints = [
            fromPos,
            { x: (fromPos.x + toPos.x) / 2, y: (fromPos.y + toPos.y) / 2 },
            toPos
          ];

          return waypoints;
        }

        function drawPath(waypoints) {
          const pathLayer = document.getElementById('path-layer');
          pathLayer.innerHTML = ''; // Clear existing paths

          if (!waypoints || waypoints.length < 2) return;

          // Create path element
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          let pathData = `M ${waypoints[0].x} ${waypoints[0].y}`;
          
          for (let i = 1; i < waypoints.length; i++) {
            pathData += ` L ${waypoints[i].x} ${waypoints[i].y}`;
          }

          path.setAttribute('d', pathData);
          path.setAttribute('class', 'path');
          pathLayer.appendChild(path);

          // Add waypoint markers
          waypoints.forEach((point, index) => {
            if (index === 0 || index === waypoints.length - 1) return; // Skip start and end points
            
            const waypoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            waypoint.setAttribute('cx', point.x);
            waypoint.setAttribute('cy', point.y);
            waypoint.setAttribute('r', 6);
            waypoint.setAttribute('class', 'path-waypoint');
            pathLayer.appendChild(waypoint);
          });
        }

        function clearPath() {
          const pathLayer = document.getElementById('path-layer');
          pathLayer.innerHTML = '';
          
          // Clear node selections
          document.querySelectorAll('.node').forEach(node => {
            node.classList.remove('selected');
          });
        }

        // Path control event listeners
        document.getElementById('findPath').addEventListener('click', function() {
          const fromSelect = document.getElementById('fromLocation');
          const toSelect = document.getElementById('toLocation');
          const from = fromSelect.value;
          const to = toSelect.value;

          if (!from || !to) {
            alert('Please select both starting point and destination');
            return;
          }

          const waypoints = findPath(from, to);
          if (waypoints) {
            drawPath(waypoints);
          }
        });

        document.getElementById('clearPath').addEventListener('click', function() {
          clearPath();
          document.getElementById('fromLocation').value = '';
          document.getElementById('toLocation').value = '';
        });

        // Search functionality
        const searchInput = document.querySelector('.search-overlay input');
        searchInput.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase();
          const nodes = document.querySelectorAll('.location-node');
          
          nodes.forEach(node => {
            const location = node.getAttribute('data-location').toLowerCase();
            if (location.includes(searchTerm)) {
              node.style.opacity = '1';
              node.style.transform = 'scale(1.2)';
            } else {
              node.style.opacity = searchTerm ? '0.3' : '1';
              node.style.transform = 'scale(1)';
            }
          });
        });
      });

      // Floors dropdown functionality
      document.addEventListener('DOMContentLoaded', function() {
        const floorsBtn = document.getElementById('floors-btn');
        const floorOptions = document.getElementById('floor-options');
        const floorLinks = document.querySelectorAll('.floor-link');

        floorsBtn.addEventListener('click', function(event) {
          event.preventDefault();
          floorOptions.classList.toggle('hidden');
        });

        floorLinks.forEach(link => {
          link.addEventListener('click', function(event) {
            event.preventDefault();
            const floorNumber = this.textContent.replace('Floor ', '');
            console.log(`Loading floor ${floorNumber}`);
            floorOptions.classList.add('hidden');
          });
        });

        document.addEventListener('click', function(event) {
          if (!floorsBtn.contains(event.target) && !floorOptions.contains(event.target)) {
            floorOptions.classList.add('hidden');
          }
        });
      });
    </script>
  </body>
</html>