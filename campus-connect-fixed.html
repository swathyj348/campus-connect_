<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .map-container {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        .map-svg {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        .map-svg:active {
            cursor: grabbing;
        }
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
        }
        .search-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 90%;
            max-width: 500px;
        }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            z-index: 20;
            display: none;
        }        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .node:hover {
            opacity: 0.8;
            transform: scale(1.2);
        }
        .node.selected {
            stroke: #000;
            stroke-width: 3;
            filter: drop-shadow(0 0 8px rgba(0,0,0,0.5));
        }
        
        /* Different node types */
        .classroom-node {
            stroke-dasharray: 2,2;
        }
        .classroom-node:hover {
            stroke-dasharray: none;
        }
        
        /* Node labels */
        .node-label {
            font-size: 10px;
            fill: #333;
            text-anchor: middle;
            pointer-events: none;
            font-weight: bold;
        }
        
        /* Path styling */
        .path {
            fill: none;
            stroke: #FF4444;
            stroke-width: 4;
            stroke-dasharray: 10,5;
            stroke-linecap: round;
            opacity: 0.8;
            animation: pathAnimation 2s infinite linear;
        }
        
        @keyframes pathAnimation {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: 30; }
        }
        
        .path-waypoint {
            fill: #FF4444;
            stroke: #fff;
            stroke-width: 2;
            r: 8;
            opacity: 0.9;
        }
        
        /* Control panel styling */
        .path-controls {
            position: absolute;
            top: 80px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 15;
            max-width: 250px;
        }
        
        .control-button {
            background: #3B82F6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            font-size: 14px;
        }
        
        .control-button:hover {
            background: #2563EB;
        }
        
        .control-button.danger {
            background: #EF4444;
        }
        
        .control-button.danger:hover {
            background: #DC2626;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="container mx-auto px-4 py-3 flex items-center justify-between">
                <h1 class="text-xl font-bold text-gray-800">Campus Connect</h1>
                <nav class="hidden md:flex space-x-6">
                    <a href="#" class="nav-link text-gray-600 hover:text-blue-500">Home</a>
                    
                    <div class="relative">
                        <button id="floors-btn" class="nav-link text-gray-600 hover:text-blue-500">Floors</button>
                        <div id="floor-options" class="absolute left-0 mt-2 py-2 w-48 bg-white rounded-md shadow-xl z-20 hidden">
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 1</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 2</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 3</a>
                            <a href="#" class="floor-link block px-4 py-2 text-gray-800 hover:bg-gray-100">Floor 4</a>
                        </div>
                    </div>
                    
                    <a href="#" class="nav-link text-gray-600 hover:text-blue-500">About</a>
                </nav>
                <button class="md:hidden text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow relative">
            <!-- Search Bar -->
            <div class="search-overlay">
                <div class="relative">
                    <input
                        type="text"
                        placeholder="Search for a location..."
                        class="w-full py-3 px-4 pr-12 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <div class="absolute right-3 top-3 text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                        </svg>
                    </div>
                </div>
            </div>            <!-- Legend Panel -->
            <div class="legend-panel" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 12px; z-index: 1000;">
                <h4 style="margin: 0 0 10px 0; color: #333;">Navigation Points</h4>
                <div class="legend-items">
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #6C5CE7; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Office Areas</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #F9CA24; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Lab Areas</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #FFD93D; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Classrooms</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #FF6B6B; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Facilities</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #00D2D3; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Entrances</span>
                    </div>
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <div style="width: 12px; height: 12px; background: #4ECDC4; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Cafeteria</span>
                    </div>
                </div>
                
                <!-- Statistics Section -->
                <div id="stats-section" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                    <h5 style="margin: 0 0 8px 0; color: #333; font-size: 11px;">Network Stats</h5>
                    <div id="network-stats" style="font-size: 10px; color: #666;">
                        Loading...
                    </div>
                </div>
            </div>

            <!-- Path Controls Panel -->
            <div class="path-controls" id="pathControls" style="display: none;">
                <h3 class="text-lg font-semibold mb-3">Navigation</h3>
                
                <!-- Filter Controls -->
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">Show:</label>
                    <div class="flex flex-wrap gap-1">
                        <button id="filter-all" class="control-button text-xs px-2 py-1">All</button>
                        <button id="filter-classrooms" class="control-button text-xs px-2 py-1" style="background: #FFD93D; color: #333;">Classrooms</button>
                        <button id="filter-facilities" class="control-button text-xs px-2 py-1" style="background: #FF6B6B;">Facilities</button>
                        <button id="filter-labs" class="control-button text-xs px-2 py-1" style="background: #F9CA24; color: #333;">Labs</button>
                    </div>
                </div><div class="mb-3">
                    <label class="block text-sm font-medium mb-1">From:</label>
                    <select id="fromLocation" class="w-full p-2 border rounded text-sm">
                        <option value="">Select starting point</option>
                        <optgroup label="Main Facilities">
                            <option value="library">Library</option>
                            <option value="cafeteria">Cafeteria</option>
                            <option value="hall">Main Hall</option>
                            <option value="lab">Computer Lab</option>
                            <option value="office">Admin Office</option>
                            <option value="entrance">Main Entrance</option>
                            <option value="faculty">Faculty Lounge</option>
                        </optgroup>
                        <optgroup label="Classrooms">
                            <option value="room401">Room 401 - Computer Science Lab</option>
                            <option value="room402">Room 402 - Mathematics</option>
                            <option value="room403">Room 403 - Physics Lab</option>
                            <option value="room404">Room 404 - Chemistry</option>
                            <option value="room405">Room 405 - Biology Lab</option>
                            <option value="room406">Room 406 - English Literature</option>
                            <option value="room407">Room 407 - History</option>
                            <option value="room408">Room 408 - Geography</option>
                            <option value="room409">Room 409 - Art Studio</option>
                            <option value="room410">Room 410 - Music Room</option>
                            <option value="room411">Room 411 - Drama Theater</option>
                            <option value="room412">Room 412 - Engineering Lab</option>
                            <option value="room413">Room 413 - Economics</option>
                            <option value="room414">Room 414 - Business Studies</option>
                            <option value="room415">Room 415 - Psychology</option>
                            <option value="room416">Room 416 - Language Lab</option>
                            <option value="room417">Room 417 - Philosophy</option>
                            <option value="room418">Room 418 - Sociology</option>
                            <option value="room419">Room 419 - Political Science</option>
                            <option value="room420">Room 420 - Statistics</option>
                        </optgroup>
                        <optgroup label="Facilities">
                            <option value="restroom1">Restroom - North Wing</option>
                            <option value="restroom2">Restroom - South Wing</option>
                        </optgroup>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">To:</label>
                    <select id="toLocation" class="w-full p-2 border rounded text-sm">
                        <option value="">Select destination</option>
                        <optgroup label="Main Facilities">
                            <option value="library">Library</option>
                            <option value="cafeteria">Cafeteria</option>
                            <option value="hall">Main Hall</option>
                            <option value="lab">Computer Lab</option>
                            <option value="office">Admin Office</option>
                            <option value="entrance">Main Entrance</option>
                            <option value="faculty">Faculty Lounge</option>
                        </optgroup>
                        <optgroup label="Classrooms">
                            <option value="room401">Room 401 - Computer Science Lab</option>
                            <option value="room402">Room 402 - Mathematics</option>
                            <option value="room403">Room 403 - Physics Lab</option>
                            <option value="room404">Room 404 - Chemistry</option>
                            <option value="room405">Room 405 - Biology Lab</option>
                            <option value="room406">Room 406 - English Literature</option>
                            <option value="room407">Room 407 - History</option>
                            <option value="room408">Room 408 - Geography</option>
                            <option value="room409">Room 409 - Art Studio</option>
                            <option value="room410">Room 410 - Music Room</option>
                            <option value="room411">Room 411 - Drama Theater</option>
                            <option value="room412">Room 412 - Engineering Lab</option>
                            <option value="room413">Room 413 - Economics</option>
                            <option value="room414">Room 414 - Business Studies</option>
                            <option value="room415">Room 415 - Psychology</option>
                            <option value="room416">Room 416 - Language Lab</option>
                            <option value="room417">Room 417 - Philosophy</option>
                            <option value="room418">Room 418 - Sociology</option>
                            <option value="room419">Room 419 - Political Science</option>
                            <option value="room420">Room 420 - Statistics</option>
                        </optgroup>
                        <optgroup label="Facilities">
                            <option value="restroom1">Restroom - North Wing</option>
                            <option value="restroom2">Restroom - South Wing</option>
                        </optgroup>
                    </select>
                </div>                <div class="flex gap-2">
                    <button id="findPath" class="control-button">Find Route</button>
                    <button id="clearPath" class="control-button danger">Clear</button>
                    <button id="testPath" class="control-button" style="background: #10B981;">Test</button>
                </div>
            </div>

            <!-- Map Container -->
            <div class="map-container">
                <!-- Direct SVG Embed of your floor plan -->
                <div id="svg-container" style="width: 100%; height: 100%; position: relative;">
                    <!-- Your SVG will be loaded here -->
                </div>

                <!-- Overlay SVG for interactive elements -->
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" 
                     style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5;"
                     viewBox="0 0 4259 2952" preserveAspectRatio="xMidYMid meet">
                    
                    <!-- Path Layer (for showing routes between nodes) -->
                    <g id="path-layer" style="pointer-events: none;">
                        <!-- Paths will be dynamically added here -->
                    </g>                    <!-- Interactive Nodes -->
                    <g id="nodes-layer" style="pointer-events: all;">
                        <!-- Main Facilities -->
                        <circle id="node-library" cx="800" cy="500" r="15" fill="#FF6B6B" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Library">
                            <title>Library</title>
                        </circle>
                        
                        <circle id="node-cafeteria" cx="1500" cy="800" r="15" fill="#4ECDC4" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Cafeteria">
                            <title>Cafeteria</title>
                        </circle>
                        
                        <circle id="node-hall" cx="2200" cy="600" r="15" fill="#45B7D1" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Main Hall">
                            <title>Main Hall</title>
                        </circle>
                        
                        <circle id="node-entrance" cx="1200" cy="1400" r="15" fill="#A0E7E5" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Main Entrance">
                            <title>Main Entrance</title>
                        </circle>                        <!-- Classrooms - Row 1 (Top) -->
                        <circle id="node-room401" cx="600" cy="300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 401" data-type="classroom">
                            <title>Room 401 - Computer Science Lab</title>
                        </circle>
                        <text x="600" y="325" class="node-label">401</text>
                        
                        <circle id="node-room402" cx="900" cy="300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 402" data-type="classroom">
                            <title>Room 402 - Mathematics</title>
                        </circle>
                        <text x="900" y="325" class="node-label">402</text>
                        
                        <circle id="node-room403" cx="1200" cy="300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 403" data-type="classroom">
                            <title>Room 403 - Physics Lab</title>
                        </circle>
                        <text x="1200" y="325" class="node-label">403</text>
                        
                        <circle id="node-room404" cx="1500" cy="300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 404" data-type="classroom">
                            <title>Room 404 - Chemistry</title>
                        </circle>
                        <text x="1500" y="325" class="node-label">404</text>
                        
                        <circle id="node-room405" cx="1800" cy="300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 405" data-type="classroom">
                            <title>Room 405 - Biology Lab</title>
                        </circle>
                        <text x="1800" y="325" class="node-label">405</text>

                        <!-- Classrooms - Row 2 (Left Side) -->
                        <circle id="node-room406" cx="300" cy="600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 406" data-type="classroom">
                            <title>Room 406 - English Literature</title>
                        </circle>
                        <text x="280" y="600" class="node-label">406</text>
                        
                        <circle id="node-room407" cx="300" cy="900" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 407" data-type="classroom">
                            <title>Room 407 - History</title>
                        </circle>
                        <text x="280" y="900" class="node-label">407</text>
                        
                        <circle id="node-room408" cx="300" cy="1200" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 408" data-type="classroom">
                            <title>Room 408 - Geography</title>
                        </circle>
                        <text x="280" y="1200" class="node-label">408</text>

                        <!-- Classrooms - Row 3 (Center) -->
                        <circle id="node-room409" cx="1200" cy="1000" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 409" data-type="classroom">
                            <title>Room 409 - Art Studio</title>
                        </circle>
                        <text x="1200" y="1025" class="node-label">409</text>
                        
                        <circle id="node-room410" cx="1500" cy="1000" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 410" data-type="classroom">
                            <title>Room 410 - Music Room</title>
                        </circle>
                        <text x="1500" y="1025" class="node-label">410</text>
                        
                        <circle id="node-room411" cx="1800" cy="1000" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 411" data-type="classroom">
                            <title>Room 411 - Drama Theater</title>
                        </circle>
                        <text x="1800" y="1025" class="node-label">411</text>

                        <!-- Classrooms - Row 4 (Right Side) -->
                        <circle id="node-room412" cx="3000" cy="400" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 412" data-type="classroom">
                            <title>Room 412 - Engineering Lab</title>
                        </circle>
                        <text x="3020" y="400" class="node-label">412</text>
                        
                        <circle id="node-room413" cx="3000" cy="700" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 413" data-type="classroom">
                            <title>Room 413 - Economics</title>
                        </circle>
                        <text x="3020" y="700" class="node-label">413</text>
                        
                        <circle id="node-room414" cx="3000" cy="1000" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 414" data-type="classroom">
                            <title>Room 414 - Business Studies</title>
                        </circle>
                        <text x="3020" y="1000" class="node-label">414</text>
                        
                        <circle id="node-room415" cx="3000" cy="1300" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 415" data-type="classroom">
                            <title>Room 415 - Psychology</title>
                        </circle>
                        <text x="3020" y="1300" class="node-label">415</text>

                        <!-- Classrooms - Row 5 (Bottom) -->
                        <circle id="node-room416" cx="600" cy="1600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 416" data-type="classroom">
                            <title>Room 416 - Language Lab</title>
                        </circle>
                        <text x="600" y="1625" class="node-label">416</text>
                        
                        <circle id="node-room417" cx="900" cy="1600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 417" data-type="classroom">
                            <title>Room 417 - Philosophy</title>
                        </circle>
                        <text x="900" y="1625" class="node-label">417</text>
                        
                        <circle id="node-room418" cx="1500" cy="1600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 418" data-type="classroom">
                            <title>Room 418 - Sociology</title>
                        </circle>
                        <text x="1500" y="1625" class="node-label">418</text>
                        
                        <circle id="node-room419" cx="1800" cy="1600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 419" data-type="classroom">
                            <title>Room 419 - Political Science</title>
                        </circle>
                        <text x="1800" y="1625" class="node-label">419</text>
                        
                        <circle id="node-room420" cx="2100" cy="1600" r="12" fill="#FFD93D" class="node location-node classroom-node" 
                                stroke="#fff" stroke-width="2" data-location="Room 420" data-type="classroom">
                            <title>Room 420 - Statistics</title>
                        </circle>
                        <text x="2100" y="1625" class="node-label">420</text>

                        <!-- Special Labs and Offices -->
                        <circle id="node-lab" cx="2800" cy="1200" r="15" fill="#F9CA24" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Computer Lab" data-type="lab">
                            <title>Computer Lab - Main</title>
                        </circle>
                        
                        <circle id="node-office" cx="3200" cy="400" r="15" fill="#6C5CE7" class="node location-node" 
                                stroke="#fff" stroke-width="3" data-location="Admin Office" data-type="office">
                            <title>Admin Office</title>
                        </circle>
                        
                        <circle id="node-faculty" cx="3500" cy="800" r="12" fill="#8E44AD" class="node location-node" 
                                stroke="#fff" stroke-width="2" data-location="Faculty Lounge" data-type="office">
                            <title>Faculty Lounge</title>
                        </circle>
                        
                        <circle id="node-restroom1" cx="2500" cy="300" r="10" fill="#95A5A6" class="node location-node" 
                                stroke="#fff" stroke-width="2" data-location="Restroom North" data-type="facility">
                            <title>Restroom - North Wing</title>
                        </circle>
                        
                        <circle id="node-restroom2" cx="2500" cy="1600" r="10" fill="#95A5A6" class="node location-node" 
                                stroke="#fff" stroke-width="2" data-location="Restroom South" data-type="facility">
                            <title>Restroom - South Wing</title>
                        </circle>
                    </g>
                </svg>

                <!-- Tooltip -->
                <div id="tooltip"></div>
            </div>

            <!-- Zoom Controls -->
            <div class="zoom-controls flex flex-col gap-2">
              <button id="zoom-in" class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
                </svg>
              </button>
              <button id="zoom-out" class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"></path>
                </svg>
              </button>
              <button id="reset-view" class="bg-white p-2 rounded-lg shadow-md hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M229.66,98.21,53.41,33l-.16-.05A16,16,0,0,0,32.9,53.25a1,1,0,0,0,.05.16L98.21,229.33A15.77,15.77,0,0,0,113.28,240h.3a15.77,15.77,0,0,0,15-11.29l23.56-76.56,76.56-23.56a16,16,0,0,0,.62-30.38ZM224,113.3l-76.56,23.56a16,16,0,0,0-10.58,10.58L113.3,224h0l-.06-.17L48,48l175.82,65.22.16.06Z"></path>
                </svg>
              </button>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white py-4 shadow-inner">
            <div class="container mx-auto px-4 text-center text-gray-600">
                <p>© 2023 Campus Map. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>      document.addEventListener('DOMContentLoaded', function() {
        // Initialize the application with red curve data
        initializeApp();
        
        // Load the external SVG file
        loadSVGMap();
        
        const tooltip = document.getElementById('tooltip');
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX, startY;
        
        // Load SVG Map Function
        function loadSVGMap() {
            fetch('./3rd_floor.svg')
                .then(response => response.text())
                .then(svgContent => {
                    const container = document.getElementById('svg-container');
                    container.innerHTML = svgContent;
                    
                    // Style the loaded SVG
                    const loadedSvg = container.querySelector('svg');
                    if (loadedSvg) {
                        loadedSvg.style.width = '100%';
                        loadedSvg.style.height = '100%';
                        loadedSvg.style.cursor = 'grab';
                        loadedSvg.classList.add('map-svg');
                        
                        // Add pan functionality to the loaded SVG
                        setupPanFunctionality(loadedSvg);
                    }
                    
                    console.log('3rd floor SVG plan loaded successfully');
                })
                .catch(error => {
                    console.error('Error loading 3rd floor SVG:', error);
                    // Fallback: show a simple rectangle
                    const container = document.getElementById('svg-container');
                    container.innerHTML = `
                        <svg viewBox="0 0 4259 2952" style="width: 100%; height: 100%; background: #f0f0f0;">
                            <rect width="4259" height="2952" fill="#ffffff" stroke="#cccccc" stroke-width="2"/>
                            <text x="2129" y="1476" text-anchor="middle" font-size="48" fill="#666666">
                                3rd Floor Plan Not Found
                            </text>
                            <text x="2129" y="1550" text-anchor="middle" font-size="32" fill="#999999">
                                Place "3rd_floor.svg" in the same folder
                            </text>
                        </svg>
                    `;
                });
        }
        
        // Setup pan functionality
        function setupPanFunctionality(svg) {
            svg.addEventListener('mousedown', function(e) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                svg.style.cursor = 'grabbing';
            });

            svg.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    translateX = e.clientX - startX;
                    translateY = e.clientY - startY;
                    updateTransform();
                }
            });

            svg.addEventListener('mouseup', function() {
                isDragging = false;
                svg.style.cursor = 'grab';
            });

            svg.addEventListener('mouseleave', function() {
                isDragging = false;
                svg.style.cursor = 'grab';
            });
        }
        
        // Update transform for both SVGs
        function updateTransform() {
            const svgContainer = document.getElementById('svg-container');
            const overlaySvg = svgContainer.nextElementSibling;
            
            const transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
            
            // Apply to main SVG
            const mainSvg = svgContainer.querySelector('svg');
            if (mainSvg) {
                mainSvg.style.transform = transform;
            }
            
            // Apply to overlay SVG
            if (overlaySvg && overlaySvg.tagName === 'svg') {
                overlaySvg.style.transform = transform;
            }
        }

        // Zoom functionality
        document.getElementById('zoom-in').addEventListener('click', function() {
            scale += 0.1;
            updateTransform();
        });

        document.getElementById('zoom-out').addEventListener('click', function() {
            if (scale > 0.3) {
                scale -= 0.1;
                updateTransform();
            }
        });
        
        document.getElementById('reset-view').addEventListener('click', function() {
            scale = 1;
            translateX = 0;
            translateY = 0;
            updateTransform();
        });

        // Node interactivity
        document.querySelectorAll('.node').forEach(node => {
            node.addEventListener('mouseover', function(e) {
                const title = this.querySelector('title').textContent;
                tooltip.style.display = 'block';
                tooltip.style.left = e.pageX + 'px';
                tooltip.style.top = e.pageY + 'px';
                tooltip.textContent = title;
            });

            node.addEventListener('mouseout', function() {
                tooltip.style.display = 'none';
            });

            node.addEventListener('click', function() {
                this.classList.toggle('selected');
                showPathControls();
            });
        });

        // Show path controls when nodes are clicked
        function showPathControls() {
            const pathControls = document.getElementById('pathControls');
            pathControls.style.display = 'block';
        }        // Path finding functionality - Updated with red curve navigation nodes
        let nodePositions = {};
        
        // Initialize the application
        async function initializeApp() {
            await loadPathfindingNodes();
            updateDropdownOptions();
            updateOverlayNodes();
        }
          // Function to load pathfinding nodes from extracted red curves
        async function loadPathfindingNodes() {
            try {
                console.log('Loading enhanced pathfinding nodes from red curves data...');
                const response = await fetch('./enhanced_red_curves_data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Enhanced red curves data loaded:', data);
                
                // Convert enhanced red curve data to node positions
                nodePositions = {};
                
                data.red_curves.forEach((curve, index) => {
                    const nodeId = `nav_${index + 1}`;
                    const coord = curve.coordinates[0]; // Use first coordinate of each curve
                    
                    // Create more descriptive labels based on room info
                    let label = `Nav ${index + 1}`;
                    if (curve.room_info && curve.room_info.room_type) {
                        const roomType = curve.room_info.room_type;
                        const distance = Math.round(curve.room_info.distance);
                        label = `${roomType.charAt(0).toUpperCase() + roomType.slice(1)} Area (${distance}px)`;
                    }
                    
                    nodePositions[nodeId] = {
                        x: coord.x,
                        y: coord.y,
                        type: 'navigation',
                        label: label,
                        roomType: curve.room_info ? curve.room_info.room_type : 'navigation',
                        connections: [] // Will be populated based on distance
                    };
                });
                
                // Calculate connections based on proximity (within 120 pixels)
                console.log('Calculating connections based on proximity');
                const nodeIds = Object.keys(nodePositions);
                nodeIds.forEach(nodeId1 => {
                    nodeIds.forEach(nodeId2 => {
                        if (nodeId1 !== nodeId2) {
                            const pos1 = nodePositions[nodeId1];
                            const pos2 = nodePositions[nodeId2];
                            const distance = calculateDistance(pos1, pos2);
                            
                            if (distance <= 120) { // Connect nodes within 120 pixels
                                if (!nodePositions[nodeId1].connections.includes(nodeId2)) {
                                    nodePositions[nodeId1].connections.push(nodeId2);
                                }
                            }
                        }
                    });
                });
                
                // Add key facility nodes for reference  
                addFacilityNodes();
                
                console.log(`Loaded ${Object.keys(nodePositions).length} enhanced pathfinding nodes`);
                  // Log statistics
                const roomTypes = {};
                Object.values(nodePositions).forEach(node => {
                    roomTypes[node.roomType] = (roomTypes[node.roomType] || 0) + 1;
                });
                console.log('Room type distribution:', roomTypes);
                
                // Update statistics display
                updateStatisticsDisplay(roomTypes);
                
                return true;
                
            } catch (error) {
                console.error('Error loading enhanced pathfinding nodes:', error);
                console.log('Falling back to basic red curves data...');
                
                // Fallback to basic red curves data
                try {
                    const fallbackResponse = await fetch('./red_curves_data.json');
                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        return await loadBasicRedCurves(fallbackData);
                    }
                } catch (fallbackError) {
                    console.error('Fallback also failed:', fallbackError);
                }
                
                // Final fallback to default nodes if loading fails
                createFallbackNodes();
                return false;
            }
        }
        
        // Add key facility nodes based on approximate locations in the 3rd floor
        function addFacilityNodes() {
            const facilities = {
                'main_entrance': { x: 1500, y: 2400, type: 'facility', label: 'Main Entrance', subject: '' },
                'library': { x: 1200, y: 2000, type: 'facility', label: 'Library', subject: '' },
                'cafeteria': { x: 900, y: 2300, type: 'facility', label: 'Cafeteria', subject: '' },
                'admin_office': { x: 2800, y: 1000, type: 'facility', label: 'Admin Office', subject: '' },
                'computer_lab': { x: 2900, y: 800, type: 'lab', label: 'Computer Lab', subject: 'CS' },
                'restrooms': { x: 1700, y: 1800, type: 'facility', label: 'Restrooms', subject: '' },
                'main_hall': { x: 2000, y: 1200, type: 'facility', label: 'Main Hall', subject: '' }
            };
            
            Object.assign(nodePositions, facilities);
        }
          // Fallback nodes if red curve data fails to load
        function createFallbackNodes() {
            nodePositions = {
                // Main Facilities
                library: { x: 800, y: 500 },
                cafeteria: { x: 1500, y: 800 },
                hall: { x: 2200, y: 600 },
                lab: { x: 2800, y: 1200 },
                office: { x: 3200, y: 400 },
                entrance: { x: 1200, y: 1400 },
                faculty: { x: 3500, y: 800 },
                
                // Some basic classroom nodes
                room401: { x: 600, y: 300 },
                room402: { x: 900, y: 300 },
                room403: { x: 1200, y: 300 },
                room404: { x: 1500, y: 300 },
                room405: { x: 1800, y: 300 },
                
                // Facilities
                restroom1: { x: 2500, y: 300 },
                restroom2: { x: 2500, y: 1600 }
            };
        }
        
        // Function to load basic red curves data as fallback
        async function loadBasicRedCurves(data) {
            try {
                console.log('Loading basic red curves data as fallback...');
                
                // Convert basic red curve data to node positions
                nodePositions = {};
                
                if (data.pathfinding_nodes) {
                    data.pathfinding_nodes.forEach((node, index) => {
                        nodePositions[node.id] = {
                            x: node.x,
                            y: node.y,
                            type: 'navigation',
                            label: `Nav ${index + 1}`,
                            roomType: 'navigation',
                            connections: node.connections || []
                        };
                    });
                } else if (data.red_curves) {
                    data.red_curves.forEach((curve, index) => {
                        const nodeId = `nav_${index + 1}`;
                        const coord = curve.coordinates[0];
                        
                        nodePositions[nodeId] = {
                            x: coord.x,
                            y: coord.y,
                            type: 'navigation',
                            label: `Nav ${index + 1}`,
                            roomType: 'navigation',
                            connections: []
                        };
                    });
                }
                
                // Add facility nodes
                addFacilityNodes();
                
                console.log(`Loaded ${Object.keys(nodePositions).length} basic pathfinding nodes`);
                return true;
                
            } catch (error) {
                console.error('Error loading basic red curves data:', error);
                return false;
            }
        }
          // Helper function to calculate distance between two positions
        function calculateDistance(pos1, pos2) {
            const dx = pos1.x - pos2.x;
            const dy = pos1.y - pos2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // Update the statistics display in the legend panel
        function updateStatisticsDisplay(roomTypes) {
            const statsElement = document.getElementById('network-stats');
            if (!statsElement) return;
            
            const totalNodes = Object.keys(nodePositions).length;
            const totalConnections = Object.values(nodePositions)
                .reduce((total, node) => total + (node.connections ? node.connections.length : 0), 0);
            
            let statsHtml = `
                <div>Total Nodes: <strong>${totalNodes}</strong></div>
                <div>Connections: <strong>${totalConnections}</strong></div>
                <div style="margin-top: 5px; font-size: 9px;">
                    ${Object.entries(roomTypes)
                        .map(([type, count]) => `${type}: ${count}`)
                        .join('<br>')}
                </div>
            `;
            
            statsElement.innerHTML = statsHtml;
        }
        
        // Update dropdown options based on loaded nodes
        function updateDropdownOptions() {
            const fromSelect = document.getElementById('fromLocation');
            const toSelect = document.getElementById('toLocation');
            
            // Clear existing options
            fromSelect.innerHTML = '<option value="">Select starting point</option>';
            toSelect.innerHTML = '<option value="">Select destination</option>';
            
            // Group nodes by type
            const facilitiesGroup = document.createElement('optgroup');
            facilitiesGroup.label = 'Facilities';
            
            const navigationGroup = document.createElement('optgroup');
            navigationGroup.label = 'Navigation Points';
            
            const labsGroup = document.createElement('optgroup');
            labsGroup.label = 'Labs & Offices';
            
            // Add nodes to appropriate groups
            Object.entries(nodePositions).forEach(([key, node]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = node.label;
                
                const optionClone = option.cloneNode(true);
                
                if (node.type === 'facility') {
                    facilitiesGroup.appendChild(option);
                    facilitiesGroup.appendChild(optionClone);
                } else if (node.type === 'lab') {
                    labsGroup.appendChild(option);
                    labsGroup.appendChild(optionClone);
                } else {
                    navigationGroup.appendChild(option);
                    navigationGroup.appendChild(optionClone);
                }
            });
            
            // Add groups to selects
            if (facilitiesGroup.children.length > 0) {
                fromSelect.appendChild(facilitiesGroup);
                toSelect.appendChild(facilitiesGroup.cloneNode(true));
            }
            if (labsGroup.children.length > 0) {
                fromSelect.appendChild(labsGroup);
                toSelect.appendChild(labsGroup.cloneNode(true));
            }
            if (navigationGroup.children.length > 0) {
                fromSelect.appendChild(navigationGroup);
                toSelect.appendChild(navigationGroup.cloneNode(true));
            }
        }
          // Update overlay nodes to show red curve navigation points
        function updateOverlayNodes() {
            const nodesLayer = document.getElementById('nodes-layer');
            
            // Clear existing nodes except the hardcoded ones
            const existingNodes = nodesLayer.querySelectorAll('.navigation-node');
            existingNodes.forEach(node => node.remove());
            
            // Color mapping for different room types
            const roomTypeColors = {
                'office': '#6C5CE7',
                'lab': '#F9CA24', 
                'classroom': '#FFD93D',
                'facility': '#FF6B6B',
                'entrance': '#00D2D3',
                'library': '#FF6B6B',
                'cafeteria': '#4ECDC4',
                'navigation': '#FF4444'
            };
            
            // Add red curve navigation nodes
            Object.entries(nodePositions).forEach(([key, node]) => {
                if (node.type === 'navigation') {
                    const roomType = node.roomType || 'navigation';
                    const color = roomTypeColors[roomType] || '#FF4444';
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.id = `node-${key}`;
                    circle.setAttribute('cx', node.x);
                    circle.setAttribute('cy', node.y);
                    circle.setAttribute('r', '6');
                    circle.setAttribute('fill', color);
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', '2');
                    circle.classList.add('node', 'location-node', 'navigation-node');
                    circle.setAttribute('data-location', node.label);
                    circle.setAttribute('data-type', 'navigation');
                    circle.setAttribute('data-room-type', roomType);
                    
                    // Add title for tooltip
                    const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                    title.textContent = `${node.label} (${roomType})`;
                    circle.appendChild(title);
                    
                    // Add event listeners
                    circle.addEventListener('mouseover', function(e) {
                        const tooltip = document.getElementById('tooltip');
                        tooltip.style.display = 'block';
                        tooltip.style.left = e.pageX + 'px';
                        tooltip.style.top = e.pageY + 'px';
                        tooltip.textContent = `${node.label} (${roomType})`;
                    });
                    
                    circle.addEventListener('mouseout', function() {
                        const tooltip = document.getElementById('tooltip');
                        tooltip.style.display = 'none';
                    });
                    
                    circle.addEventListener('click', function() {
                        this.classList.toggle('selected');
                        showPathControls();
                    });
                    
                    nodesLayer.appendChild(circle);
                }
            });
        }        function findPath(from, to) {
            if (!from || !to || from === to) return null;
            
            const fromPos = nodePositions[from];
            const toPos = nodePositions[to];
            
            if (!fromPos || !toPos) return null;

            // Use A* pathfinding algorithm with red curve connections
            const path = findShortestPath(from, to);
            
            if (path && path.length > 0) {
                // Convert node IDs to positions
                return path.map(nodeId => nodePositions[nodeId]);
            }
            
            // Fallback to direct path if no connected route found
            return [fromPos, toPos];
        }
        
        // A* pathfinding algorithm using red curve connections
        function findShortestPath(startId, endId) {
            const openSet = [startId];
            const cameFrom = new Map();
            const gScore = new Map();
            const fScore = new Map();
            
            // Initialize scores
            Object.keys(nodePositions).forEach(nodeId => {
                gScore.set(nodeId, Infinity);
                fScore.set(nodeId, Infinity);
            });
            
            gScore.set(startId, 0);
            fScore.set(startId, heuristic(startId, endId));
            
            while (openSet.length > 0) {
                // Get node with lowest fScore
                let current = openSet.reduce((min, nodeId) => 
                    fScore.get(nodeId) < fScore.get(min) ? nodeId : min
                );
                
                if (current === endId) {
                    // Reconstruct path
                    const path = [];
                    while (current) {
                        path.unshift(current);
                        current = cameFrom.get(current);
                    }
                    return path;
                }
                
                openSet.splice(openSet.indexOf(current), 1);
                  // Check neighbors (connected nodes)
                const currentNode = nodePositions[current];
                if (currentNode.connections && currentNode.connections.length > 0) {
                    currentNode.connections.forEach(neighborId => {
                        if (!nodePositions[neighborId]) return;
                        
                        const distance = calculateDistanceByNodeId(current, neighborId);
                        const tentativeGScore = gScore.get(current) + distance;
                        
                        if (tentativeGScore < gScore.get(neighborId)) {
                            cameFrom.set(neighborId, current);
                            gScore.set(neighborId, tentativeGScore);
                            fScore.set(neighborId, tentativeGScore + heuristic(neighborId, endId));
                            
                            if (!openSet.includes(neighborId)) {
                                openSet.push(neighborId);
                            }
                        }
                    });
                } else {
                    // If no direct connections, check nearby nodes
                    const nearbyNodes = findNearbyNodes(current, 150); // 150 unit radius
                    nearbyNodes.forEach(neighborId => {
                        if (neighborId === current) return;
                        
                        const distance = calculateDistanceByNodeId(current, neighborId);
                        const tentativeGScore = gScore.get(current) + distance;
                        
                        if (tentativeGScore < gScore.get(neighborId)) {
                            cameFrom.set(neighborId, current);
                            gScore.set(neighborId, tentativeGScore);
                            fScore.set(neighborId, tentativeGScore + heuristic(neighborId, endId));
                            
                            if (!openSet.includes(neighborId)) {
                                openSet.push(neighborId);
                            }
                        }
                    });
                }
            }
            
            return null; // No path found
        }
          // Heuristic function for A* (Euclidean distance)
        function heuristic(nodeId1, nodeId2) {
            return calculateDistanceByNodeId(nodeId1, nodeId2);
        }
        
        // Calculate distance between two nodes by their IDs
        function calculateDistanceByNodeId(nodeId1, nodeId2) {
            const node1 = nodePositions[nodeId1];
            const node2 = nodePositions[nodeId2];
            if (!node1 || !node2) return Infinity;
            
            return calculateDistance(node1, node2);
        }
        
        // Find nodes within a certain radius
        function findNearbyNodes(nodeId, radius) {
            const centerNode = nodePositions[nodeId];
            if (!centerNode) return [];
            
            return Object.keys(nodePositions).filter(otherNodeId => {
                if (otherNodeId === nodeId) return false;
                const distance = calculateDistanceByNodeId(nodeId, otherNodeId);
                return distance <= radius;
            });
        }

        function drawPath(waypoints) {
            const pathLayer = document.getElementById('path-layer');
            pathLayer.innerHTML = ''; // Clear existing paths

            if (!waypoints || waypoints.length < 2) return;

            // Create path element
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            let pathData = `M ${waypoints[0].x} ${waypoints[0].y}`;
            
            for (let i = 1; i < waypoints.length; i++) {
                pathData += ` L ${waypoints[i].x} ${waypoints[i].y}`;
            }

            path.setAttribute('d', pathData);
            path.setAttribute('class', 'path');
            pathLayer.appendChild(path);

            // Add waypoint markers
            waypoints.forEach((point, index) => {
                if (index === 0 || index === waypoints.length - 1) return; // Skip start and end points
                
                const waypoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                waypoint.setAttribute('cx', point.x);
                waypoint.setAttribute('cy', point.y);
                waypoint.setAttribute('r', 6);
                waypoint.setAttribute('class', 'path-waypoint');
                pathLayer.appendChild(waypoint);
            });
        }

        function clearPath() {
            const pathLayer = document.getElementById('path-layer');
            pathLayer.innerHTML = '';
            
            // Clear node selections
            document.querySelectorAll('.node').forEach(node => {
                node.classList.remove('selected');
            });
        }

        // Path control event listeners
        document.getElementById('findPath').addEventListener('click', function() {
            const fromSelect = document.getElementById('fromLocation');
            const toSelect = document.getElementById('toLocation');
            const from = fromSelect.value;
            const to = toSelect.value;

            if (!from || !to) {
                alert('Please select both starting point and destination');
                return;
            }

            const waypoints = findPath(from, to);
            if (waypoints) {
                drawPath(waypoints);
            }
        });        document.getElementById('clearPath').addEventListener('click', function() {
            clearPath();
            document.getElementById('fromLocation').value = '';
            document.getElementById('toLocation').value = '';
        });
        
        document.getElementById('testPath').addEventListener('click', function() {
            console.log('Testing pathfinding with enhanced red curve data...');
            console.log(`Total nodes available: ${Object.keys(nodePositions).length}`);
            
            // Test with first few navigation nodes
            const navNodes = Object.keys(nodePositions).filter(id => id.startsWith('nav_')).slice(0, 5);
            if (navNodes.length >= 2) {
                const from = navNodes[0];
                const to = navNodes[navNodes.length - 1];
                
                console.log(`Testing path from ${from} to ${to}`);
                console.log(`From position:`, nodePositions[from]);
                console.log(`To position:`, nodePositions[to]);
                
                const waypoints = findPath(from, to);
                if (waypoints && waypoints.length > 0) {
                    console.log(`Path found with ${waypoints.length} waypoints:`, waypoints);
                    drawPath(waypoints);
                    
                    // Update the dropdowns to show the test
                    document.getElementById('fromLocation').value = from;
                    document.getElementById('toLocation').value = to;
                } else {
                    console.log('No path found in test');
                }
            } else {
                console.log('Not enough navigation nodes for testing');
            }
            
            // Log some statistics
            const roomTypes = {};
            Object.values(nodePositions).forEach(node => {
                const type = node.roomType || node.type || 'unknown';
                roomTypes[type] = (roomTypes[type] || 0) + 1;
            });
            console.log('Current node distribution:', roomTypes);
        });// Search functionality - Enhanced for dynamically loaded nodes
        const searchInput = document.querySelector('.search-overlay input');
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            // Search through loaded nodePositions
            Object.keys(nodePositions).forEach(nodeId => {
                const node = nodePositions[nodeId];
                const nodeElement = document.getElementById(`node-${nodeId}`);
                
                if (nodeElement) {
                    const label = node.label.toLowerCase();
                    const type = node.type.toLowerCase();
                    const subject = (node.subject || '').toLowerCase();
                    
                    if (label.includes(searchTerm) || type.includes(searchTerm) || subject.includes(searchTerm) || nodeId.includes(searchTerm)) {
                        nodeElement.style.opacity = '1';
                        nodeElement.style.transform = 'scale(1.3)';
                        nodeElement.style.filter = 'drop-shadow(0 0 10px rgba(255,68,68,0.8))';
                    } else {
                        nodeElement.style.opacity = searchTerm ? '0.3' : '1';
                        nodeElement.style.transform = 'scale(1)';
                        nodeElement.style.filter = 'none';
                    }
                }
            });
            
            // Also search static SVG nodes
            const staticNodes = document.querySelectorAll('.location-node:not(.navigation-node)');
            staticNodes.forEach(node => {
                const location = node.getAttribute('data-location');
                const title = node.querySelector('title');
                
                if (location && title) {
                    const locationText = location.toLowerCase();
                    const titleText = title.textContent.toLowerCase();
                    
                    if (locationText.includes(searchTerm) || titleText.includes(searchTerm)) {
                        node.style.opacity = '1';
                        node.style.transform = 'scale(1.2)';
                        node.style.filter = 'drop-shadow(0 0 8px rgba(255,215,0,0.8))';
                    } else {
                        node.style.opacity = searchTerm ? '0.3' : '1';
                        node.style.transform = 'scale(1)';
                        node.style.filter = 'none';
                    }
                }
            });
            
            // Handle static labels
            const labels = document.querySelectorAll('.node-label');
            labels.forEach(label => {
                const labelText = label.textContent.toLowerCase();
                if (labelText.includes(searchTerm)) {
                    label.style.fill = '#FF4444';
                    label.style.fontWeight = 'bold';
                } else {
                    label.style.fill = '#333';
                    label.style.fontWeight = 'normal';
                }
            });
        });        // Filter functionality - Updated for navigation nodes
        document.getElementById('filter-all').addEventListener('click', function() {
            showAllNodes();
            setActiveFilter(this);
        });

        document.getElementById('filter-classrooms').addEventListener('click', function() {
            filterNodes('classroom');
            setActiveFilter(this);
        });

        document.getElementById('filter-facilities').addEventListener('click', function() {
            filterNodes(['facility', 'library', 'cafeteria', 'hall', 'entrance']);
            setActiveFilter(this);
        });

        document.getElementById('filter-labs').addEventListener('click', function() {
            filterNodes(['lab', 'office', 'navigation']);
            setActiveFilter(this);
        });

        function showAllNodes() {
            // Show static nodes
            const staticNodes = document.querySelectorAll('.location-node');
            const labels = document.querySelectorAll('.node-label');
            
            staticNodes.forEach(node => {
                node.style.display = 'block';
                node.style.opacity = '1';
            });
            
            labels.forEach(label => {
                label.style.display = 'block';
            });
            
            // Show navigation nodes
            const navNodes = document.querySelectorAll('.navigation-node');
            navNodes.forEach(node => {
                node.style.display = 'block';
                node.style.opacity = '1';
            });
        }

        function filterNodes(types) {
            if (typeof types === 'string') {
                types = [types];
            }
            
            // Handle static nodes
            const staticNodes = document.querySelectorAll('.location-node:not(.navigation-node)');
            const labels = document.querySelectorAll('.node-label');
            
            staticNodes.forEach((node, index) => {
                const nodeType = node.getAttribute('data-type') || 'facility';
                const nodeId = node.id;
                
                let shouldShow = false;
                types.forEach(type => {
                    if (nodeType === type || 
                        (type === 'library' && nodeId.includes('library')) ||
                        (type === 'cafeteria' && nodeId.includes('cafeteria')) ||
                        (type === 'hall' && nodeId.includes('hall')) ||
                        (type === 'entrance' && nodeId.includes('entrance'))) {
                        shouldShow = true;
                    }
                });
                
                node.style.display = shouldShow ? 'block' : 'none';
                node.style.opacity = shouldShow ? '1' : '0.3';
            });
            
            // Handle navigation nodes
            const navNodes = document.querySelectorAll('.navigation-node');
            navNodes.forEach(node => {
                const shouldShow = types.includes('navigation') || types.includes('lab');
                node.style.display = shouldShow ? 'block' : 'none';
                node.style.opacity = shouldShow ? '1' : '0.3';
            });
            
            // Handle labels for classroom nodes
            labels.forEach(label => {
                const labelX = parseFloat(label.getAttribute('x'));
                const labelY = parseFloat(label.getAttribute('y'));
                
                const correspondingNode = Array.from(staticNodes).find(node => {
                    const nodeX = parseFloat(node.getAttribute('cx'));
                    const nodeY = parseFloat(node.getAttribute('cy'));
                    return Math.abs(nodeX - labelX) < 25 && Math.abs(nodeY - labelY) < 30;
                });
                
                if (correspondingNode && correspondingNode.style.display === 'none') {
                    label.style.display = 'none';
                } else {
                    label.style.display = 'block';
                }
            });
        }

        function setActiveFilter(activeButton) {
            // Remove active state from all filter buttons
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.style.opacity = '0.7';
                btn.style.fontWeight = 'normal';
            });
            
            // Set active state
            activeButton.style.opacity = '1';
            activeButton.style.fontWeight = 'bold';
        }

        // Initialize with all nodes visible
        showAllNodes();
        setActiveFilter(document.getElementById('filter-all'));

        // Floors dropdown functionality
        const floorsBtn = document.getElementById('floors-btn');
        const floorOptions = document.getElementById('floor-options');
        const floorLinks = document.querySelectorAll('.floor-link');

        floorsBtn.addEventListener('click', function(event) {
            event.preventDefault();
            floorOptions.classList.toggle('hidden');
        });

        floorLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const floorNumber = this.textContent.replace('Floor ', '');
                console.log(`Loading floor ${floorNumber}`);
                floorOptions.classList.add('hidden');
                // Here you could load different floor SVG files
            });
        });

        document.addEventListener('click', function(event) {
            if (!floorsBtn.contains(event.target) && !floorOptions.contains(event.target)) {
                floorOptions.classList.add('hidden');
            }
        });
      });
    </script>
</body>
</html>
